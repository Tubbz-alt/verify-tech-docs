---
title: Architecture
weight: 05
---

# Architecture

**Insert image**

## Step 1

The user initiates the Verify process from their browser when they request to log into the government service.

## Step 2

The government service sends a JSON authentication request to the Verify Service Provider (VSP). The VSP converts the JSON request into a SAML authentication request.

## Step 3

The VSP sends the SAML authentication request back to the government service. The government service then signs the SAML request and forwards it to the GOV.UK Verify hub. The request shows that a user wants to access the government service and needs to prove their identity using GOV.UK Verify.

## Step 4

The GOV.UK Verify hub prompts the user to select an identity provider to authenticate them. The GOV.UK Verify hub anonymises the government service and forwards the SAML authentication request to the identity provider the user chose. The identity provider authenticates the user based on the required [level of assurance](LINK).

## Step 5

The identity provider then [signs](LINK) and sends a SAML response to the GOV.UK Verify hub. The SAML response contains an authentication context assertion and an identity assertion, both signed by the identity provider and [encrypted](LINK) for the GOV.UK Verify hub. The authentication context assertion validates the user’s authentication and contains the [level of assurance](LINK). The identity assertion contains the user’s [matching dataset](LINK) and the [persistent identifier](LINK).

To learn more about the contents of the assertions, see [matching cycles](LINK) and [user account creation](LINK).

## Step 6

The GOV.UK Verify hub signs and sends a SAML attribute query to the government service’s Matching Service Adapter. The SAML attribute query is encrypted for the Matching Service Adapter and contains the identity assertion signed by the identity provider.

## Step 7

The Matching Service Adapter anonymises the identity provider, translates the SAML attribute query into a JSON matching request, and forwards it to the service’s Local Matching Service. The Local Matching Service tries to [match](LINK) the user with a record in the government service’s database.

## Step 8

The Local Matching Service returns a `match` or `no-match` JSON response to the Matching Service Adapter.

## Step 9

If the response is `match`, the Matching Service Adapter translates the JSON response into a SAML attribute query response, signs it, and forwards it to the GOV.UK Verify hub. The attribute query response contains an assertion signed by the Matching Service Adapter and encrypted for the GOV.UK Verify hub. The assertion contains the hashed persistent identifier, the ID of the matched record from the government service database, and level of assurance.

## Step 10

The GOV.UK Verify hub signs and sends a SAML response to the government service, completing user authentication. The SAML response contains an assertion signed by the Matching Service Adapter and is encrypted for the government service. The government service forwards it to the VSP for verification and translation to JSON.

## Step 11

The VSP returns a JSON response to the government service, forwarding the record ID for the matched identity.

## Step 12

The government service gets the user’s record from the datastore based on the record ID. This allows the government service to interact with the user.
